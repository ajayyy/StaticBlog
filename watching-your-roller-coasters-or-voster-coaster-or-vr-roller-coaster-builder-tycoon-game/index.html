<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.7"/><meta name="theme-color" content="#fff"/><style data-href="/styles.98c208488f7e0918f3b4.css" data-identity="gatsby-global-css">body{margin:8px}.profilepic{border-radius:50%;height:80px;overflow:hidden}#title,.profilepic{vertical-align:middle}#title{background-color:#636363;color:#212121;font-family:sans-serif;font-size:50px;padding:20px;text-align:center;transition:font-size 1s}#title,.title-text{text-decoration:none}.title-text:hover{color:#212121}body{background-color:#333;color:#c4c4c4;font-family:sans-serif;font-size:1.1rem;line-height:1.5}code{font-size:12pt!important}a{color:inherit;transition:color .1s linear}a:hover{color:#fff}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}pre[class*=language-].line-numbers{counter-reset:linenumber;padding-left:3.8em;position:relative}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{border-right:1px solid #999;font-size:100%;left:-3.8em;letter-spacing:-1px;pointer-events:none;position:absolute;top:0;-webkit-user-select:none;user-select:none;width:3em}.line-numbers-rows>span{counter-increment:linenumber;display:block}.line-numbers-rows>span:before{color:#999;content:counter(linenumber);display:block;padding-right:.8em;text-align:right}.blog-post-content{margin:auto;max-width:60%;text-align:left}@media screen and (orientation:portrait){.blog-post-content{max-width:100%}}.blog-post-content img{max-width:100%}.blog-post-container{text-align:center}.gatsby-highlight pre[class*=language-].line-numbers{overflow:initial;padding:0 0 0 2.8em}</style><link rel="icon" href="/favicon-32x32.png?v=a60a5f8134c1a0a70ea7cd9216912b32" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a60a5f8134c1a0a70ea7cd9216912b32"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a60a5f8134c1a0a70ea7cd9216912b32"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a60a5f8134c1a0a70ea7cd9216912b32"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a60a5f8134c1a0a70ea7cd9216912b32"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a60a5f8134c1a0a70ea7cd9216912b32"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a60a5f8134c1a0a70ea7cd9216912b32"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a60a5f8134c1a0a70ea7cd9216912b32"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a60a5f8134c1a0a70ea7cd9216912b32"/><link rel="alternate" type="application/rss+xml" title="Ajay Ramachandran&#x27;s Blog" href="/rss.xml"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div id="title"><img src="/ajay_profile.jpg" class="profilepic"/> <a class="title-text" href="/">Ajay Ramachandran</a></div><main><div class="blog-post-container"><div class="blog-post"><h1>Watching Your Roller Coasters | Voster Coaster | VR Roller Coaster Builder Tycoon Game</h1><h2>July 30, 2018</h2><div class="blog-post-content"><p><img src="/images/QmeBMht5zypqDnSw7V2bQZMLLjNcr9rhK7KD3jPHAN6Hct" alt="track preview.gif"></p>
<h1>Repository</h1>
<p><a href="https://github.com/ajayyy/VosterCoasterVR">https://github.com/ajayyy/VosterCoasterVR</a></p>
<h1>Watching your roller coasters</h1>
<p>After finishing the ability to build roller coasters, I set out to allow the roller coasters to be run. I wanted this to be as realistic as possible so that I can later use the data to gather g-forces to know the intensity of roller coasters that are created.</p>
<h1>Physical approach</h1>
<p>When I first was thinking of ways to create a preview of your roller coaster, I thought of using the default physics engine. I would create meshes on each track and try to slide a box across the whole thing.</p>
<p>This started looking like it was going to work perfectly, but sadly it did not because of a small issue in the physics engine. Whenever it got to a crease between the one track pieces collision mesh and another's, there was a chance it would suddenly jump upward.</p>
<p>This drove me nuts trying to find what was causing this problem. I tried many things to try to fix this.</p>
<h3>Smooth out the meshes</h3>
<p>Because of how curves work, the size of the collider might have to be slightly different for each track piece. At first, I thought this was the issue, but fixing sizes did nothing.</p>
<h3>Wheels</h3>
<p>In real life, wheels do not slide across a surface, they roll.</p>
<p>I then attempted to create a rolling ball down the tracks.</p>
<p>Sadly, the same jumping issue remained.</p>
<h3>Even more realism</h3>
<p><img src="/images/QmS1uK893oUJvqeTfm8pBTHo4U5JVzzBsGb7DeSp32uiAf" alt="image.png"></p>
<p>I tried recreating a real roller coaster's wheel system by having wheels above and below the track.</p>
<p><img src="/images/QmcmD8ZRqs6MXhi4KFjYaPo885F3WWDFs3RNoy6XtJNP9x" alt="image.png"></p>
<p>This still had the same issues and it was boggling my mind.</p>
<h3>Multiple meshes</h3>
<p>After more research, I discovered that the issue probably stems from the fact that multiple colliders are being used. Combining the colliders will surely help!</p>
<p>To do this, I created many planes where the colliders before used to be and merged them into one.</p>
<div class="gatsby-highlight" data-language="c#"><pre style="counter-reset: linenumber NaN" class="language-c# line-numbers"><code class="language-c#">//Create cubes and offset them based on each bone&#39;s position
for (int b = 0; b &lt; bones.Count; b++) {
    float size;

    if (b + 1 &gt;= bones.Count || (b + 1) % rollerCoaster.boneAmount == 0) {
        //if there is no next position, use the last position instead
        size = lastSize;
    } else {
        Vector3 nextPosition = bones[b + 1].position;
        size = Vector3.Distance(bones[b].position, nextPosition) / GameController.instance.scale;
    }

    cubes[b] = CreatePlane(offset + bones[b].position / GameController.instance.scale, new Vector3(1, 1, size), bones[b].rotation);

    lastSize = size;
}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>This still was having jumping issues, which made no sense.</p>
<h3>Simplifying mesh</h3>
<p>I concluded that this must be because each track is still being treated as a seperate mesh, even though it is all combined into one. I tried using resources to simplify the mesh with no luck.</p>
<p>After all this, I learned that this physics engine is not practical to make a realistic roller coaster simulation with.</p>
<h1>Custom Approach</h1>
<p>Time and time again, I learn how much making a custom system works better than trying to use many other systems together to do something it was never designed for.</p>
<p>I also learned how making custom physics will help me so much in the future when I will need to calculate the g-forces of the roller coasters to determine intensity and other statistics.</p>
<p>To do this, I thought of the track as a straight line, and made the position variable just be specifying the position on that straight line.</p>
<p>Each frame, the velocity must be added to the position (divided by the physics frame rate)</p>
<div class="gatsby-highlight" data-language="c#"><pre style="counter-reset: linenumber NaN" class="language-c# line-numbers"><code class="language-c#">position += velocity / 60f;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>And each frame, the acceleration must be added to the velocity. But how is the acceleration calculated? This is calculated based on gravity on an inclined plane.</p>
<div class="gatsby-highlight" data-language="c#"><pre style="counter-reset: linenumber NaN" class="language-c# line-numbers"><code class="language-c#">//calculate the force downward (divided by 60 fps)
float forceDown = (-9.81f) / 60f;

//calculate the amount of that force used on an incline of the angle (same as acceleration)
float gravityAcceleration = Mathf.Sin(inclineAngleOfTrack * Mathf.Deg2Rad) * forceDown;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p><img src="/images/QmccqpLXSurc931HpFTdm5BwKRbHPQPxWyy3H5BRzzqf1J" alt="image.png"></p>
<p>The blue arrow is the downward force and the red arrow is what we are trying to find. The green arrow would be found if you use cosine instead.</p>
<p>After finding the acceleration, it can be added it to the velocity.</p>
<div class="gatsby-highlight" data-language="c#"><pre style="counter-reset: linenumber NaN" class="language-c# line-numbers"><code class="language-c#">//calculate the new movements
velocity += gravityAcceleration;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Friction can also be added.</p>
<div class="gatsby-highlight" data-language="c#"><pre style="counter-reset: linenumber NaN" class="language-c# line-numbers"><code class="language-c#">if (velocity &gt; 0) {
    velocity -= friction;
    if (velocity &lt; 0) {
        velocity = 0;
    }
} else {
    velocity += friction;
    if (velocity &gt; 0) {
        velocity = 0;
    }
}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3>Displaying the results</h3>
<p>To display the results, the new position on the track line can then be calculated.</p>
<div class="gatsby-highlight" data-language="c#"><pre style="counter-reset: linenumber NaN" class="language-c# line-numbers"><code class="language-c#">Transform finalBone = GetCurrentBone(true);</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>However, in this game, everything is stored in bones, which are 1/10th of a track. Yes, that area is pretty small, but not small enough, so the difference between this bone and the next bone needs to be calculated to see how much farther from the current bone of the current track piece the cart should be placed.</p>
<div class="gatsby-highlight" data-language="c#"><pre style="counter-reset: linenumber NaN" class="language-c# line-numbers"><code class="language-c#">Vector3 extraAmount = new Vector3(0, 0, 1) * (distanceToNextBone * (boneNum - (int)boneNum));
transform.position = finalBone.position + MathHelper.RotatePointAroundPivot(offsetAmount, Vector3.zero, finalBone.rotation) - MathHelper.RotatePointAroundPivot(extraAmount, Vector3.zero, finalBone.rotation);</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>This same thing can be used with the rotation.</p>
<div class="gatsby-highlight" data-language="c#"><pre style="counter-reset: linenumber NaN" class="language-c# line-numbers"><code class="language-c#">Vector3 angleDifference = nextBone.eulerAngles - finalBone.eulerAngles;
Vector3 extraRotation = angleDifference * (boneNum - (int)boneNum);
transform.eulerAngles = finalBone.eulerAngles + extraRotation;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<h1>Pull Request</h1>
<p><a href="https://github.com/ajayyy/VosterCoaster/pull/15">https://github.com/ajayyy/VosterCoaster/pull/15</a></p>
<h1>GitHub Account</h1>
<p><a href="https://github.com/ajayyy">https://github.com/ajayyy</a></p></div></div></div></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/watching-your-roller-coasters-or-voster-coaster-or-vr-roller-coaster-builder-tycoon-game";window.___webpackCompilationHash="ee9f93a22f5d812d53ee";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-2027c615c2b1d449723b.js"],"app":["/app-a8a88917d557b5d5c239.js"],"component---src-pages-404-js":["/component---src-pages-404-js-6e293d823d5e173acc7a.js"],"component---src-pages-index-js":["/component---src-pages-index-js-4c00f30d3c318a368679.js"],"component---src-pages-sponsorblock-js":["/component---src-pages-sponsorblock-js-03e17db57ab08e6d8408.js"],"component---src-pages-vostercoaster-js":["/component---src-pages-vostercoaster-js-dee0d7b7fa6b58872b3e.js"],"component---src-templates-blog-template-js":["/component---src-templates-blog-template-js-d0d2c490581e9ed2d6f1.js"]};/*]]>*/</script><script src="/polyfill-2027c615c2b1d449723b.js" nomodule=""></script><script src="/app-a8a88917d557b5d5c239.js" async=""></script><script src="/framework-c0acfd4b44c09a0159f3.js" async=""></script><script src="/webpack-runtime-f415ec79cfe5feaa0178.js" async=""></script></body></html>